<!doctype html>
//http://webdeveloperguy.blogspot.dk/
<html>
  <head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <title>Socket.IO chat</title>
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body { font: 13px Helvetica, Arial; }
      form { background: #000; padding: 3px; position: fixed; bottom: 0; width: 100%; }
      form input { border: 0; padding: 10px; width: 90%; margin-right: .5%; }
      form button { width: 9%; background: rgb(130, 224, 255); border: none; padding: 10px; }
      #messages { list-style-type: none; margin: 0; padding: 0; }
      #messages li { padding: 5px 10px; }
      #messages li:nth-child(odd) { background: #eee; }
      #messages { margin-bottom: 40px }
    </style>
  </head>
  <body>
    <div>
      Pick a message:
      <button id="m1" type="button" class="btn btn-primary">Primary</button>
      <button id="m2" type="button" class="btn btn-secondary">Secondary</button>
      <button id="m3" type="button" class="btn btn-success">Success</button>
    </div>
    <ul id="messages"></ul>
    ------------------------
    <form action="">
      <input id="m" autocomplete="off" /><button>Send</button>
    </form>
    <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
    <!-- <script src="https://code.jquery.com/jquery-1.11.1.js"></script> -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

    <script>
      function shuffle(array) {
        var currentIndex = array.length, temporaryValue, randomIndex;
        // While there remain elements to shuffle..
        while (0 !== currentIndex) {
          // Pick a remaining element...
          randomIndex = Math.floor(Math.random() * currentIndex);
          currentIndex -= 1;
          // And swap it with the current element.
          temporaryValue = array[currentIndex];
          array[currentIndex] = array[randomIndex];
          array[randomIndex] = temporaryValue;
        }
        return array;
      }
      $(function () {
        
        let questions=[
          "The Referendum was not influenced by Cambridge Analytica",
          "The Referendum was influenced by Cambridge Analytica",
          "The Referendum was not influenced by Facebook",
          "The Referendum was influenced by Facebook",
          "The Referendum was not influenced by Russians",
          "The Referendum was influenced by Russians",
          "Leaving EU will save Britons from vegans"
        ]

        const solution1=["The Referendum","Leaving EU", "The British Parliment"]

        const solution31=["Cambridge Analytica", "Russians", "Facebook", "aliens", "vegans", "cyclists"]
        const solution32=["money", "people from dying","the Queen","Britons from vegans","Britons from migrants"]
        const solution33=["security"]
        const solution34=["investors", "Russians", "aliens", "vegans", "cyclists"]
        const solution35=["jobs", "travel problems"]
        
        const solution2=[
          {text:"was not influenced by",children:solution31}, 
          {text:"was influenced by",children:solution31}, 
          {text:"will save", children:solution32}, 
          {text:"will improve", children:solution33},
          {text:"will attract",children:solution34},
          {text:"will repel",children:solution34 },
          {text:"will generate",children:solution35}
        ]
        questions = shuffle(questions);
        let candidateQuestions = questions.slice(0, 3);
        $('#m1').text(candidateQuestions[0]);
        $('#m2').text(candidateQuestions[1]);
        $('#m3').text(candidateQuestions[2]);
        // console.log(questions);
        //var item = items[Math.floor(Math.random()*items.length)];

        var socket = io();
        $('form').submit(function(){
          message = $('#m').val();
          messageType = 'chat message';
          if (message.startsWith("__CONTROL__")) {
            messageType = 'control';
          }
          if (message.startsWith("__RIDDLE__")) {
            messageType = 'riddle';
          }
          if (message.startsWith("__SOLUTION__")) {
            messageType = 'solution';
          }
          socket.emit(messageType, message.replace(/^__.*__/, ''));
          $('#m').val('');
          return false;
        });
        socket.on('chat message', function(msg){
          $('#messages').append($('<li>').text(msg));
          window.scrollTo(0, document.body.scrollHeight);
        });

        // Displaying other types of messages - debugging only now, this needs to be translated
        // to events in the UI.
        socket.on('control', function(msg){
          $('#messages').append($('<li>').text("CONTROL: " + msg));
          window.scrollTo(0, document.body.scrollHeight);
        });
        socket.on('riddle', function(msg){
          $('#messages').append($('<li>').text("RIDDLE: " + msg));
          window.scrollTo(0, document.body.scrollHeight);
        });
        socket.on('solution', function(msg){
          $('#messages').append($('<li>').text("SOLUTION: " + msg));
          window.scrollTo(0, document.body.scrollHeight);
        });

      });
    </script>
  </body>
</html>
